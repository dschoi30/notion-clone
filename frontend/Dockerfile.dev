FROM node:22-bookworm-slim
WORKDIR /app
COPY package.json pnpm-lock.yaml .npmrc .pnpmfile.cjs ./
RUN apt-get update && apt-get install -y python3 make g++ git && rm -rf /var/lib/apt/lists/*
RUN corepack enable && corepack prepare pnpm@latest --activate
ENV NODE_ENV=development
ENV CHOKIDAR_USEPOLLING=true
ENV PNPM_NODE_LINKER=hoisted
ENV PNPM_SHAMEFULLY_HOIST=true
ENV NPM_CONFIG_BUILD_FROM_SOURCE=false
RUN pnpm config set never-built-dependencies[] inotify
RUN pnpm install --include=dev
RUN ls -la node_modules/.bin/ | head -10
COPY . .
EXPOSE 5173
CMD ["pnpm", "dev", "--host", "0.0.0.0"]